<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset=UTF-8>
    <title>保洁plus套餐限时3重优惠</title>
    <meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <link rel=stylesheet type=text/css href='__PUBLIC__/myWeb/Public/Admin/css/reset.css?is=1'>
    <link href="//static.360buyimg.com/static-sale-m/dist/view/css/base.css?t=20171027185038" rel=stylesheet type=text/css>
    <script type=text/config id=jdAppType>jdapp,jdsmart,walletclient,jdcarapp,jdsg</script>
    <script type=text/javascript src="//static.360buyimg.com/static-sale-m/dist/view/lib/common.js?t=20171027185038"></script>
    <script type=text/javascript src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>
    <script>
      window.browser = {
        versions: function () {
          let u = navigator.userAgent;
          return {
            trident: u.indexOf('Trident') > -1,
            presto: u.indexOf('Presto') > -1,
            webKit: u.indexOf('AppleWebKit') > -1,
            gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') === -1,
            mobile: !!u.match(/AppleWebKit.*Mobile.*/),
            ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
            android: u.indexOf('Android') > -1,
            iPhone: u.indexOf('iPhone') > -1,
            iPad: u.indexOf('iPad') > -1,
            jdjr: u.indexOf('JDJR-App') > -1,
            webApp: u.indexOf('Safari') === -1,
            wechat: u.indexOf('MicroMessenger') !== -1
          };
        }(), language: (navigator.browserLanguage || navigator.language).toLowerCase()
      };</script>
    <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
//      window.ga = function () {
//        console.log('ga', arguments)
//      };
      window.ga('create', 'UA-115976658-1', 'auto');
      function getRequest() {
        var url = window.location.href;
//                console.log(url);
        if (url.indexOf('?') !== -1) {
          var str = url.substr(url.indexOf('?') + 1);
          var strs = str.split('&');
          var result = {};
          for (var temp in strs) {
            var tp = strs[temp].split('=');
            result[tp[0]] = tp[1];
          }
          return result;
        } else {
          return {};
        }
      }
      function ajax() {
        var ajaxData = {
          type: arguments[0].type || "GET",
          url: arguments[0].url || "",
          async: arguments[0].async || "true",
          data: arguments[0].data || null,
          dataType: arguments[0].dataType || "text",
          contentType: arguments[0].contentType || "application/x-www-form-urlencoded",
          beforeSend: arguments[0].beforeSend || function () {
          },
          success: arguments[0].success || function () {
          },
          error: arguments[0].error || function () {
          }
        };
        ajaxData.beforeSend();
        var xhr = createxmlHttpRequest();
        xhr.responseType = ajaxData.dataType;
        xhr.open(ajaxData.type, ajaxData.url, ajaxData.async);
        xhr.setRequestHeader("Content-Type", ajaxData.contentType);
        xhr.send(convertData(ajaxData.data));
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4) {
            if (xhr.status == 200) {
              ajaxData.success(xhr.response)
            } else {
              ajaxData.error()
            }
          }
        }
      }
      function createxmlHttpRequest() {
        if (window.ActiveXObject) {
          return new ActiveXObject("Microsoft.XMLHTTP");
        } else if (window.XMLHttpRequest) {
          return new XMLHttpRequest();
        }
      }
      function convertData(data) {
        if (typeof data === 'object') {
          var convertResult = "";
          for (var c in data) {
            convertResult += c + "=" + data[c] + "&";
          }
          convertResult = convertResult.substring(0, convertResult.length - 1)
          return convertResult;
        } else {
          return data;
        }
      }
      var para = getRequest();
      var GAStr;
      var paraStr = '';

      if (para.aid) {
        paraStr = paraStr + '&aid=' + para.aid;
      }
      if (para.utm_medium) {
        paraStr = paraStr + '&utm_medium=' + para.utm_medium;
      }
      if (para.utm_source) {
        paraStr = paraStr + '&utm_source=' + para.utm_source;
      }
      if (para.utm_campaign) {
        paraStr = paraStr + '&utm_campaign=' + para.utm_campaign;
      }
      if (paraStr.length > 1) {
        paraStr = '?' + paraStr.substring(1);
      }
//      GAStr = window.location.pathname + window.location.hash.substring(1) + paraStr;
      GAStr = window.location.pathname + window.location.hash.substring(1);
      window.ga('send', 'pageview', GAStr);
      //ajax({
      //    type:"POST",
      //    url:"https://" + window.location.host + "/myWeb/WeChat/WeChatTrack/collectChannel",
      ////    dataType:"json",
      //    data:{
      //        channelId: para.utm_medium,
      //        sgId: 13,
      //        scenceId: para.utm_source,
      //        status: 0
      //    }
      //})
    </script>
    <style type="text/css">
        body {
            background-color: #a4e5fd;
        }
        .mainapp {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        .mainapp .pic1 {
            width: 100vw;
            height: 161.8vw;
            background-image: url(https://file.rose52.com/guanjia/activity/0710ejq/bjhd01.jpg);
            background-position: 0 0;
            background-size: 100%;
            background-repeat: no-repeat;
        }
        .mainapp .pic1 #pic1Img{
            width: 100vw;
            height: 14.4vw;
            background-position: 0 0;
            background-size: 100%;
            background-repeat: no-repeat;
        }
        .mainapp .pic1 .djlq{
            background-image: url(https://file.rose52.com/guanjia/activity/0710ejq/djlq@2x.png);
        }
        .mainapp .pic1 .ylq{
            background-image: url(https://file.rose52.com/guanjia/activity/0710ejq/ylq@2x.png);
        }
        .mainapp .pic1 .ylw{
            background-image: url(https://file.rose52.com/guanjia/activity/0710ejq/ylw@2x.png);
        }
        .mainapp .pic2 {
            width: 100vw;
            height: 122.1vw;
            background-image: url(https://file.rose52.com/guanjia/activity/0710ejq/bjhd02.jpg);
            background-position: 0 0;
            background-size: 100%;
            background-repeat: no-repeat;
        }
        .mainapp .pic2 #pic2Img{
            width: 100vw;
            height: 14.4vw;
            background-position: 0 0;
            background-size: 100%;
            background-repeat: no-repeat;
            background-image: url(https://file.rose52.com/guanjia/activity/0710ejq/lklj@2x.png);
        }
        .mainapp .pic3 {
            width: 100vw;
            height: 73.6vw;
            background-image: url(https://file.rose52.com/guanjia/activity/0710ejq/bjhd03.jpg);
            background-position: 0 0;
            background-size: 100%;
            background-repeat: no-repeat;
        }

        .mainapp .area {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .mainapp div a #pic2Img {
            width: 100%;
            flex-shrink: 0;
        }
        .mainapp div #pic1Img {
            width: 100%;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
<div class="mainapp">
    <div class="pic1 area"><div class="djlq" id="pic1Img" onclick="getCoupon();"></div></div>
    <div class="pic2 area"><a href="/myWeb/WeChat/WeChatGuanJia/product?id=89"><div id="pic2Img"></div></a></div>
    <div class="pic3"></div>
</div>
<script>
    let pic1Img = document.getElementById('pic1Img');
    let pic2Img = document.getElementById('pic2Img');
    const authurl = `{$loginurl}/user/login.action?appid=422&returnurl=${window.location.origin}${window.location.pathname}?aid=14`;

    let lock = false;

    function getCoupon() {
      if (!lock) {
        lock = true;
        let url = '/myWeb/CouponApi/Coupon/pickUpCouponWithCode';
        ajax({
          type:"POST",
          url: url,
          data:{
            code: '全屋保洁PLUS'
          },
          success(res) {
            res = JSON.parse(res);
            if (parseInt(res.state) === 1) {
              alert('领取成功');
              pic1Img.className = 'ylq';
            }
            else if (parseInt(res.state) === 3) {
              window.location.href = authurl;
            }
            else {
              if (res.msg === '该优惠券已经被兑换') {
                pic1Img.className = 'ylq';
                alert(res.msg);
              } else if (res.msg === '您来晚了，优惠券已兑完') {
                pic1Img.className = 'ylw';
                alert(res.msg);
              } else {
                alert('网络异常，请稍候重试');
                lock = false;
              }
            }
          }
        })
      }
    }

    function setShare() {
      if (window.browser.versions.wechat) {
        let optionsWx = {
          url: '/myWeb/AjaxApi/WeChatGuanJia/getJssdkParam',
          type: 'POST',
          data: {
            url: encodeURIComponent(window.location.href)
          },
          success(res) {
            res = JSON.parse(res);
            if (parseInt(res.state) === 1) {
              let data = res.data;
              if (!data.gjEnable) {
                wx.config(data);
                wx.ready(() => {
                  wx.onMenuShareAppMessage({
                    title: '保洁plus套餐限时3重优惠',
                    link: `${window.location.origin}${window.location.pathname}?aid=14`,
                    desc: '新品限时体验，神券仅此一周',
                    imgUrl: 'https://file.rose52.com/guanjia/activity/0710ejq/ejqfx.jpg',
                    success: function() {
                      alert('分享成功');
                    }
                  });
                  wx.onMenuShareTimeline({
                    title: '保洁plus套餐限时3重优惠', // 分享标题
                    link: `${window.location.origin}${window.location.pathname}?aid=14`,
                    imgUrl: 'https://file.rose52.com/guanjia/activity/0710ejq/ejqfx.jpg',
                    success: function () {
                      // 用户确认分享后执行的回调函数
                      alert('分享成功');
                    },
                    cancel: function () {
                      // 用户取消分享后执行的回调函数
                    }
                  });
                });
                wx.error((res) => {
                  alert('网络异常，请稍候重试');
                });
              }

            }
          }
        };

        ajax(optionsWx);
      }
    }
    setShare();

</script>
{$jdUnder}
</body>
</html>